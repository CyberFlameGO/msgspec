<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Changelog" href="changelog.html" /><link rel="prev" title="API Docs" href="api.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Benchmarks</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: black;
  --color-brand-content: #024bb0;
  --color-foreground-muted: #808080;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #ffffcc;
  --color-sidebar-link-text: black;
  --color-sidebar-link-text--top-level: black;
  --color-link: #024bb0;
  --color-link--hover: #024bb0;
  --color-link-underline: transparent;
  --color-link-underline--hover: #024bb0;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffffff;
  --color-brand-content: #5192d2;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #333300;
  --color-sidebar-link-text: #ffffffcc;
  --color-sidebar-link-text--top-level: #ffffffcc;
  --color-link: #5192d2;
  --color-link--hover: #5192d2;
  --color-link-underline: transparent;
  --color-link-underline--hover: #5192d2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffffff;
  --color-brand-content: #5192d2;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #333300;
  --color-sidebar-link-text: #ffffffcc;
  --color-sidebar-link-text--top-level: #ffffffcc;
  --color-link: #5192d2;
  --color-link--hover: #5192d2;
  --color-link-underline: transparent;
  --color-link-underline--hover: #5192d2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">msgspec</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/msgspec-logo-light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/msgspec-logo-dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="structs.html">Structs</a></li>
<li class="toctree-l1"><a class="reference internal" href="constraints.html">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">JSON Schema</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending</a></li>
<li class="toctree-l1"><a class="reference internal" href="perf-tips.html">Performance Tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/geojson.html">GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/asyncio-kv.html">Asyncio TCP Key-Value Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/conda-repodata.html">Conda Repodata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Docs</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="benchmarks">
<h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Benchmarks are <em>hard</em>.</p>
<p>Repeatedly calling the same function in a tight loop will lead to the
instruction cache staying hot and branches being highly predictable. That’s
not representative of real world access patterns. It’s also hard to write a
nonbiased benchmark. I wrote msgspec, naturally whatever benchmark I
publish it’s going to perform well in.</p>
<p>Even so, people like to see benchmarks. I’ve tried to be as nonbiased as I
can be, and the results hopefully indicate a few tradeoffs you make when
you choose different serialization formats. I encourage you to write your
own benchmarks before making these decisions.</p>
</div>
<section id="benchmark-encoding-decoding">
<span id="encoding-benchmark"></span><h2>Benchmark - Encoding/Decoding<a class="headerlink" href="#benchmark-encoding-decoding" title="Permalink to this heading">#</a></h2>
<p>Here we show a simple benchmark serializing some structured data. The data
we’re serializing has the following schema (defined here using <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a>
types):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">msgspec</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
    <span class="n">street</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">zip</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
    <span class="n">first</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">addresses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Address</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">telephone</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The libraries we’re benchmarking are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ujson</span></code> - <a class="reference external" href="https://github.com/ultrajson/ultrajson">ujson</a> with dict message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orjson</span></code> - <a class="reference external" href="https://github.com/ijl/orjson">orjson</a> with dict message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgpack</span></code> - <a class="reference external" href="https://github.com/msgpack/msgpack-python">msgpack</a> with dict message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyrobuf</span></code> - <a class="reference external" href="https://github.com/appnexus/pyrobuf">pyrobuf</a> with protobuf message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">msgpack</span></code> - <a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a>’s MessagePack encoding, with <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a>
message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">msgpack</span> <span class="pre">array-like</span></code> - <a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a>’s MessagePack encoding, with
<a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> message types configured with <code class="docutils literal notranslate"><span class="pre">array_like=True</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">json</span></code> - <a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a>’s JSON encoding, with <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> message types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">json</span> <span class="pre">array-like</span></code> - <a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a>’s JSON encoding, with <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a>
message types configured with <code class="docutils literal notranslate"><span class="pre">array_like=True</span></code></p></li>
</ul>
<p>Each benchmark creates one or more instances of a <code class="docutils literal notranslate"><span class="pre">Person</span></code> message, and
serializes it/deserializes it in a loop. The <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks">full benchmark source can be
found here</a>.</p>
<section id="object">
<h3>1 Object<a class="headerlink" href="#object" title="Permalink to this heading">#</a></h3>
<p>Some workflows involve sending around very small messages. Here the overhead
per function call dominates (parsing of options, allocating temporary buffers,
etc…).</p>
<div id="bench-1"></div><p>From the chart above, you can see that <code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">msgpack</span> <span class="pre">array-like</span></code> is the
fastest method for both serialization and deserialization. This makes sense;
with <code class="docutils literal notranslate"><span class="pre">array_like=True</span></code> <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> types don’t serialize the field names
in each message (things like <code class="docutils literal notranslate"><span class="pre">&quot;first&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;last&quot;</span></code>, …), only the values,
leading to smaller messages and higher performance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">msgpack</span></code> and <code class="docutils literal notranslate"><span class="pre">msgspec</span> <span class="pre">json</span></code> benchmarks also performed quite
well, encoding/decoding faster than all other options, even those implementing
the same serialization protocol. This is partly due to the use of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code>
types here - since all keys are statically known, the msgspec decoders can
apply a few optimizations not available to other Python libraries that rely on
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> types instead.</p>
<p>That said, all of these methods serialize/deserialize pretty quickly relative
to other python operations, so unless you’re counting every microsecond your
choice here probably doesn’t matter that much.</p>
</section>
<section id="objects">
<h3>1000 Objects<a class="headerlink" href="#objects" title="Permalink to this heading">#</a></h3>
<p>Here we serialize a list of 1000 <code class="docutils literal notranslate"><span class="pre">Person</span></code> objects. There’s a lot more data
here, so the per-call overhead will no longer dominate, and we’re now measuring
the efficiency of the encoding/decoding.</p>
<div id="bench-1k"></div></section>
<section id="schema-validation">
<h3>Schema Validation<a class="headerlink" href="#schema-validation" title="Permalink to this heading">#</a></h3>
<p>The above benchmarks aren’t 100% fair to <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> or <code class="docutils literal notranslate"><span class="pre">pyrobuf</span></code>. Both
libraries also perform schema validation on deserialization, checking that the
message matches the specified schema. None of the other options benchmarked
support this natively. Instead, many users perform validation post
deserialization using additional tools like <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a>. Here we add the cost of
schema validation during deserialization, using <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a> for all libraries
lacking builtin validation.</p>
<div id="bench-1-validate"></div><div id="bench-1k-validate"></div><p>These plots show the performance benefit of performing type validation during
message decoding (as done by <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> and <a class="reference external" href="https://github.com/appnexus/pyrobuf">pyrobuf</a>) rather than as a
secondary step with a third-party library like <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a>. Validating after
decoding is slower for two reasons:</p>
<ul class="simple">
<li><p>It requires traversing over the entire output structure a second time (which
can be slow due to pointer chasing)</p></li>
<li><p>It may require converting some python objects to their desired output types
(e.g. converting a decoded <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> to a <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a> model), resulting in
allocating many temporary python objects.</p></li>
</ul>
<p>In contrast, libraries like <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> that validate during decoding have none
of these issues. Only a single pass over the decoded data is taken, and the
specified output types are created correctly the first time, avoiding the need
for additional unnecessary allocations.</p>
</section>
</section>
<section id="benchmark-structs">
<span id="struct-benchmark"></span><h2>Benchmark - Structs<a class="headerlink" href="#benchmark-structs" title="Permalink to this heading">#</a></h2>
<p>Here we benchmark common <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> operations, comparing their
performance against other similar libraries. The cases compared are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span></code></p></li>
<li><p>Standard Python classes</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a></p></li>
<li><p><a class="reference external" href="https://www.attrs.org">attrs</a></p></li>
<li><p><a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a></p></li>
</ul>
<p>For each library, the following operations are benchmarked:</p>
<ul class="simple">
<li><p>Time to define a new class. Many libraries that abstract away class
boilerplate add overhead when defining classes, slowing import times for
libraries that make use of these classes.</p></li>
<li><p>Time to create an instance of that class.</p></li>
<li><p>Time to compare two instances for equality (<code class="docutils literal notranslate"><span class="pre">==</span></code>/<code class="docutils literal notranslate"><span class="pre">!=</span></code>).</p></li>
<li><p>Time to compare two instances for order (<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>/<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>/<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>/<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>)</p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_structs.py">full benchmark source can be found here</a>.</p>
<p><strong>Results (smaller is better):</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>import (μs)</p></th>
<th class="head"><p>create (μs)</p></th>
<th class="head"><p>equality (μs)</p></th>
<th class="head"><p>order (μs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>msgspec</strong></p></td>
<td><p>9.92</p></td>
<td><p>0.09</p></td>
<td><p>0.02</p></td>
<td><p>0.03</p></td>
</tr>
<tr class="row-odd"><td><p><strong>standard classes</strong></p></td>
<td><p>6.86</p></td>
<td><p>0.45</p></td>
<td><p>0.13</p></td>
<td><p>0.29</p></td>
</tr>
<tr class="row-even"><td><p><strong>dataclasses</strong></p></td>
<td><p>489.07</p></td>
<td><p>0.47</p></td>
<td><p>0.27</p></td>
<td><p>0.30</p></td>
</tr>
<tr class="row-odd"><td><p><strong>attrs</strong></p></td>
<td><p>428.38</p></td>
<td><p>0.42</p></td>
<td><p>0.29</p></td>
<td><p>2.15</p></td>
</tr>
<tr class="row-even"><td><p><strong>pydantic</strong></p></td>
<td><p>371.52</p></td>
<td><p>4.84</p></td>
<td><p>10.56</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Standard Python classes are the fastest to import (any library can only add
overhead here). Still, <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> isn’t <em>that</em> much slower, especially
compared to other options.</p></li>
<li><p>Structs are optimized to be cheap to create, and that shows for the creation
benchmark. They’re roughly 5x faster than standard
classes/<code class="docutils literal notranslate"><span class="pre">attrs</span></code>/<code class="docutils literal notranslate"><span class="pre">dataclasses</span></code>, and 50x faster than <code class="docutils literal notranslate"><span class="pre">pydantic</span></code>.</p></li>
<li><p>For equality comparison, msgspec Structs are roughly 6x to 500x faster than
the alternatives.</p></li>
<li><p>For order comparison, msgspec Structs are roughly 10x to 70x faster than the
alternatives.</p></li>
</ul>
</section>
<section id="benchmark-garbage-collection">
<span id="struct-gc-benchmark"></span><h2>Benchmark - Garbage Collection<a class="headerlink" href="#benchmark-garbage-collection" title="Permalink to this heading">#</a></h2>
<p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances implement several optimizations for reducing garbage
collection (GC) pressure and decreasing memory usage. Here we benchmark structs
(with and without <a class="reference internal" href="structs.html#struct-gc"><span class="std std-ref">gc=False</span></a>) against standard Python
classes (with and without <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#slots">__slots__</a>).</p>
<p>For each option we create a large dictionary containing many simple instances
of the benchmarked type, then measure:</p>
<ul class="simple">
<li><p>The amount of time it takes to do a full garbage collection (gc) pass</p></li>
<li><p>The total amount of memory used by this data structure</p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_gc.py">full benchmark source can be found here</a>.</p>
<p><strong>Results (smaller is better):</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>GC time (ms)</p></th>
<th class="head"><p>Memory Used (MiB)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>standard class</strong></p></td>
<td><p>80.46</p></td>
<td><p>211.66</p></td>
</tr>
<tr class="row-odd"><td><p><strong>standard class with __slots__</strong></p></td>
<td><p>80.06</p></td>
<td><p>120.11</p></td>
</tr>
<tr class="row-even"><td><p><strong>msgspec struct</strong></p></td>
<td><p>13.96</p></td>
<td><p>120.11</p></td>
</tr>
<tr class="row-odd"><td><p><strong>msgspec struct with gc=False</strong></p></td>
<td><p>1.07</p></td>
<td><p>104.85</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Standard Python classes are the most memory hungry (since all data is stored
in an instance dict). They also result in the largest GC pause, as the GC has
to traverse the entire outer dict, each class instance, and each instance
dict. All that pointer chasing has a cost.</p></li>
<li><p>Standard classes with <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> are less memory hungry, but still results
in an equivalent GC pauses.</p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances have the same memory layout as a class with
<code class="docutils literal notranslate"><span class="pre">__slots__</span></code> (and thus have the same memory usage), but due to deferred GC
tracking a full GC pass completes in a fraction of the time.</p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances with <code class="docutils literal notranslate"><span class="pre">gc=False</span></code> have the lowest memory usage
(lack of GC reduces memory by 16 bytes per instance). They also have the
lowest GC pause (75x faster than standard classes!) since the entire
composing dict can be skipped during GC traversal.</p></li>
</ul>
</section>
<section id="benchmark-library-size">
<span id="id1"></span><h2>Benchmark - Library Size<a class="headerlink" href="#benchmark-library-size" title="Permalink to this heading">#</a></h2>
<p>Here we compare the on-disk size of a few Python libraries.</p>
<p>The <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_library_size.py">full benchmark source can be found here</a>.</p>
<p><strong>Results (smaller is better)</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>version</p></th>
<th class="head"><p>size (MiB)</p></th>
<th class="head"><p>vs. msgspec</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>msgspec</strong></p></td>
<td><p>0.7.1</p></td>
<td><p>0.23</p></td>
<td><p>1.00x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>orjson</strong></p></td>
<td><p>3.7.5</p></td>
<td><p>0.56</p></td>
<td><p>2.50x</p></td>
</tr>
<tr class="row-even"><td><p><strong>msgpack</strong></p></td>
<td><p>1.0.4</p></td>
<td><p>0.99</p></td>
<td><p>4.37x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>pydantic</strong></p></td>
<td><p>1.9.1</p></td>
<td><p>40.82</p></td>
<td><p>180.50x</p></td>
</tr>
</tbody>
</table>
</div>
<p>The functionality available in <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> is comparable to that of <a class="reference external" href="https://github.com/ijl/orjson">orjson</a>,
<a class="reference external" href="https://github.com/msgpack/msgpack-python">msgpack</a>, and <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a> combined. However, the total installed binary size of
<code class="docutils literal notranslate"><span class="pre">msgspec</span></code> is a fraction of that of any of these libraries.</p>
<script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script><script type="text/javascript">

function buildPlot(div, rows, title) {
    var i, time_unit, scale, max_time = 0;
    for (i = 0; i < rows.length; i++) {
        var total = rows[i][1] + rows[i][2];
        if (total > max_time) {
            max_time = total;
        }
    }
    if (max_time < 1e-6) {
        time_unit = "ns";
        scale = 1e9;
    }
    else if (max_time < 1e-3) {
        time_unit = "μs";
        scale = 1e6;
    }
    else {
        time_unit = "ms";
        scale = 1e3;
    }

    var columns = ["encode", "decode", "total"];
    var data = [];
    for (i = 0; i < rows.length; i++) {
        var lib = rows[i][0];
        var et = rows[i][1] * scale;
        var dt = rows[i][2] * scale;
        var tt = et + dt;
        data.push({library: lib, method: "encode", time: et});
        data.push({library: lib, method: "decode", time: dt});
        data.push({library: lib, method: "total", time: tt});
    }

    var spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json",
        "title": title,
        "config": {
            "view": {"continuousHeight": 250, "stroke": null},
            "legend": {"title": null},
        },
        "data": {"values": data},
        "transform": [
            {
                "calculate": `join([format(datum.time, '.3'), ' ${time_unit}'], '')`,
                "as": "tooltip",
            }
        ],
        "mark": "bar",
        "encoding": {
            "color": {
                "field": "method",
                "type": "nominal",
                "scale": {"scheme": "tableau20"},
                "sort": columns,
            },
            "column": {
                "field": "library",
                "header": {"labelExpr": "split(datum.label, ' ')", "orient": "bottom"},
                "sort": {"field": "time", "op": "sum", "order": "descending"},
                "title": null,
                "type": "nominal",
            },
            "tooltip": {"field": "tooltip", "type": "nominal"},
            "x": {
                "axis": {"labels": false, "ticks": false, "title": null},
                "field": "method",
                "type": "nominal",
                "sort": columns,
            },
            "y": {
                "axis": {"grid": false, "title": `Time (${time_unit})`},
                "field": "time",
                "type": "quantitative",
            },
        },
    };
    vegaEmbed(div, spec);
}

var data = {"1": [["ujson", 7.030435859924182e-07, 7.639844279037788e-07], ["orjson", 2.729362859972753e-07, 4.700861860765144e-07], ["msgpack", 3.361755030346103e-07, 6.437368659535423e-07], ["pyrobuf", 6.585190480109304e-07, 8.175451980205253e-07], ["msgspec msgpack", 1.1347354299505241e-07, 2.1372027799952774e-07], ["msgspec msgpack array-like", 8.304792979033664e-08, 1.827640509873163e-07], ["msgspec json", 1.491183284961153e-07, 2.529406379908323e-07], ["msgspec json array-like", 1.2631406149012035e-07, 2.012530609499663e-07]], "1k": [["ujson", 0.001102395214838907, 0.0015488704800372944], ["orjson", 0.0003646563779911958, 0.0009273472519125789], ["msgpack", 0.0006639056000858545, 0.001252785309916362], ["pyrobuf", 0.001007149354845751, 0.0012639255350222812], ["msgspec msgpack", 0.0001816850150062237, 0.0005268073680344969], ["msgspec msgpack array-like", 0.00013447317949612624, 0.00046300101198721677], ["msgspec json", 0.00026055755803827197, 0.0005569243360077962], ["msgspec json array-like", 0.00021961575601017101, 0.00044483237201347947]], "1-valid": [["ujson", 6.967446720227599e-07, 7.38570460001938e-06], ["orjson", 2.7809841802809387e-07, 7.023546079872176e-06], ["msgpack", 3.3430971595225853e-07, 7.071110340766609e-06], ["pyrobuf", 6.591738880379126e-07, 8.14532220014371e-07], ["msgspec msgpack", 1.1331076300120913e-07, 2.1414168103365227e-07], ["msgspec msgpack array-like", 8.293645720696077e-08, 1.8254028499359264e-07], ["msgspec json", 1.5054226550273598e-07, 2.4940696998965e-07], ["msgspec json array-like", 1.2410027100122535e-07, 1.9837152998661623e-07]], "1k-valid": [["ujson", 0.00129786730511114, 0.02141073290258646], ["orjson", 0.00044180043006781486, 0.02110853819758631], ["msgpack", 0.0007393227140419185, 0.02092509400099516], ["pyrobuf", 0.0012027352498262189, 0.0013232087399228476], ["msgspec msgpack", 0.00021633048250805587, 0.0006201737138908357], ["msgspec msgpack array-like", 0.00016943000350147486, 0.0005656970220152288], ["msgspec json", 0.0003191211699740961, 0.0006765304539585487], ["msgspec json array-like", 0.0002677371469908394, 0.000542826394084841]]};
buildPlot('#bench-1', data["1"], "Benchmark - 1 Object");
buildPlot('#bench-1k', data["1k"], "Benchmark - 1000 Objects");
buildPlot('#bench-1-validate', data["1-valid"], "Benchmark - 1 Object, With Validation");
buildPlot('#bench-1k-validate', data["1k-valid"], "Benchmark - 1000 Objects, With Validation");
</script></section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changelog.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="api.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">API Docs</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Jim Crist-Harif
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/jcrist/msgspec" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
</svg></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Benchmarks</a><ul>
<li><a class="reference internal" href="#benchmark-encoding-decoding">Benchmark - Encoding/Decoding</a><ul>
<li><a class="reference internal" href="#object">1 Object</a></li>
<li><a class="reference internal" href="#objects">1000 Objects</a></li>
<li><a class="reference internal" href="#schema-validation">Schema Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benchmark-structs">Benchmark - Structs</a></li>
<li><a class="reference internal" href="#benchmark-garbage-collection">Benchmark - Garbage Collection</a></li>
<li><a class="reference internal" href="#benchmark-library-size">Benchmark - Library Size</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    </body>
</html>